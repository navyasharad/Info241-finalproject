---
title: "final-project"
output: html_document
date: "2025-12-09"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
#Working directory
getwd()
list.files()
d<- read.csv("Info 241 - VR Curated Data - Sheet1.csv")
```
```{r}
#Getting column names
colnames(d)
```
```{r}
colnames(d) <- c("participant", "exposure", "start_time", "end_time", "")


```

```{r}
#Converting time format
str(d$Excitement..scale.1.9.)
str(d$Total.time.spent)

d$Excitement..scale.1.9. <- as.numeric(d$Excitement..scale.1.9.)
Happiness..scale.1.9 <- as.numeric(d$Happiness..scale.1.9)

# Split the string by ":"
time_parts <- strsplit(d$Total.time.spent, ":")
# Convert to total seconds
d$Total.time.spent.sec <- sapply(time_parts, function(x) {
  h <- as.numeric(x[1])
  m <- as.numeric(x[2])
  s <- as.numeric(x[3])
  total_sec <- h*3600 + m*60 + s
  return(total_sec)
})
```
#Run data distributions

```{r}
#Linear model comparing time spent to happiness, excitement, and exposure. Desn't account for two groups.
model<- lm(Total.time.spent.sec ~ Happiness..scale.1.9 + Excitement..scale.1.9. + X1st.or.2nd.environment, data = d, na.action = na.omit)
summary(model)
```
```{r}
# Creating a column in the dataset for condition
d$Condition <- ifelse(
  d$Participant.. %in% c(1:6, 17:21, 26:28),
  1,  # glass dome
  2   # brick dome
)

# Check
table(d$Condition)
head(d)
```
```{r}
# Subset data for Exposure 1. Did condition affect happiness or excitement?
d_exp1 <- subset(d, X1st.or.2nd.environment == "Second")
d_exp1$Happiness..scale.1.9. <- as.numeric(d_exp1$Happiness..scale.1.9.)
d_exp1$Excitement..scale.1.9. <- as.numeric(d_exp1$Excitement..scale.1.9.)
d_exp1$Total.time.spent.sec <- as.numeric(d_exp1$Total.time.spent.sec)

# Run the linear model on Exposure 1 or 2 only
#On the right side, only pre treatment so cant include nausea
model_happiness <- lm( Happiness..scale.1.9. ~ Condition,
                  data = d_exp1,
                  na.action = na.omit)
model_excitement <- lm(Excitement..scale.1.9. ~ Condition + Total.time.spent.sec + Happiness..scale.1.9.,
                  data = d_exp1,
                  na.action = na.omit)
model_time <- lm( Total.time.spent.sec ~ Condition + Happiness..scale.1.9. + Excitement..scale.1.9.,
                  data = d_exp1,
                  na.action = na.omit)


# View summary
summary(model_happiness)
summary(model_excitement)
summary(model_time)

```
#None of the models are significant. Am I regressing the right thing here? I am envisioning happiness, excitement, and time spent are the DV dependent on condition (but I guess they're not really). I also ran the same models not filtered by exposure, didn't really matter. Does the filter even make sense?


```{r}
boxplot(as.numeric(Happiness..scale.1.9.) ~ Condition, data = d)

library(ggplot2)

d |> 
  ggplot() + 
  aes(x=as.factor(Condition), y = Happiness..scale.1.9.) + 
  geom_jitter()

d |> 
  group_by(Condition) |> 
  summarise(mean_views = mean(as.numeric(Happiness..scale.1.9.), na.rm = T))
```

```{r}
#Within subjects! Filter by condition and then run pairwise ttest
library(dplyr)
library(tidyr)

# Filter for Condition 1 (or 2)
d_condition <- d %>%
  filter(Condition == 1)  # change to 2 for Condition 2

# Convert relevant columns to numeric
d_numeric <- d %>%
  mutate(
    Happiness..scale.1.9. = as.numeric(Happiness..scale.1.9.),
    Excitement..scale.1.9. = as.numeric(Excitement..scale.1.9.),
    Total.time.spent.sec = as.numeric(Total.time.spent.sec)
  )

# Reshape to wide format
d_wide <- d_numeric %>%
  select(Participant.., X1st.or.2nd.environment,
         Happiness..scale.1.9., Excitement..scale.1.9., Total.time.spent.sec) %>%
  pivot_wider(
    id_cols = Participant..,
    names_from = X1st.or.2nd.environment,
    values_from = c(Happiness..scale.1.9., Excitement..scale.1.9., Total.time.spent.sec)
  )

# Compute differences
d_wide <- d_wide %>%
  mutate(
    Happiness_diff = Happiness..scale.1.9._Second - Happiness..scale.1.9._First,
    Excitement_diff = Excitement..scale.1.9._Second - Excitement..scale.1.9._First,
    Time_diff = Total.time.spent.sec_Second - Total.time.spent.sec_First
  )

# Paired t-tests for this condition
t_hap_paired <- t.test(d_wide$Happiness..scale.1.9._First,
                       d_wide$Happiness..scale.1.9._Second,
                       paired = TRUE)
t_hap_paired

t_exc_paired <- t.test(d_wide$Excitement..scale.1.9._First,
                       d_wide$Excitement..scale.1.9._Second,
                       paired = TRUE)
t_exc_paired

t_time_paired <- t.test(d_wide$Total.time.spent.sec_First,
                       d_wide$Total.time.spent.sec_Second,
                       paired = TRUE)
t_time_paired
```
#Within subjects condition 1 is glass dome, brick cube and condition 2 is brick dome, glass cube. 
#Questions cond 2
#1. Seems interesting that ttest for time doesnt show a difference in means like at all?
#2. What do we say about a 0.13 p value, it's not sig but what range does it fall in I guess? For happiness
#Questions cond 1
#1. People seem to spend more time in the brick cube than glass dome, p = 0.09. Worth reporting? This seems weird also because it's the second exposure?

```{r}
# Between subjects! Filter for first exposure
d_first <- subset(d, X1st.or.2nd.environment == "Second") #Change to Second for second exposure 

# Keep only complete cases for Happiness, Excitement, and Condition
d_first_clean <- d_first[!is.na(d_first$Happiness..scale.1.9.) &
                         !is.na(d_first$Excitement..scale.1.9.) &
                         !is.na(d_first$Condition), ]

# Convert to correct types
d_first_clean$Happiness..scale.1.9. <- as.numeric(d_first_clean$Happiness..scale.1.9.)
d_first_clean$Excitement..scale.1.9. <- as.numeric(d_first_clean$Excitement..scale.1.9.)
d_first_clean$Condition <- as.factor(d_first_clean$Condition)
d_first_clean$Total.time.spent.sec = as.numeric(d_first_clean$Total.time.spent.sec)

# Check group sizes
table(d_first_clean$Condition)

  t_hap <- t.test(Happiness..scale.1.9. ~ Condition, data = d_first_clean)
  t_exc <- t.test(Excitement..scale.1.9. ~ Condition, data = d_first_clean)
  t_time <- t.test(Total.time.spent.sec ~ Condition, data = d_first)
  
  print("Happiness t-test:")
  print(t_hap)
  
  print("Excitement t-test:")
  print(t_exc)

  print("Time t-test:")
  print(t_time)

```
#Exposure 2 is brick cube, glass cube
#Questions
#1. we see p = 0.31, happiness in brick cube is higher than glass cube. They're both second exposure, so I think we can compare? Does this p value matter if not sig?
#2. we see p=0.06 for time and that people spend a lot more time in the glass cube than the brick cube. yay! first very close to sig value. but it doesn't line up with happiness and excitement. How do we report this (do we?)?
#Exposure 1 is glass dome, brick dome
#Nothing significant here
#How can we incoprate random inference here? Can we run a randomization for the 1-9 scales and compare our collected survey values to chance? Not sure if this makes sense.

```{r} #How bout dis? from chat
library(lme4)

# Example: Happiness
model_happiness_mixed <- lmer(Happiness..scale.1.9. ~ Condition + Total.time.spent.sec + Excitement..scale.1.9. + (1 | Participant..),
                              data = d, REML = FALSE)

summary(model_happiness_mixed)

```

```{r}
library(purrr)
library(readr)
library(stringr)

#List all HR and EA CSVs recursively, so it searches the file path name and can sort by glass or brick
hr_files <- list.files(pattern = "-HR\\.csv$", full.names = TRUE, recursive = TRUE)
ea_files<- list.files(pattern = "-EA\\.csv$", full.names = TRUE, recursive = TRUE)

#Separate by dome type
hr_glass_files <- hr_files[str_detect(hr_files, "glass")]
hr_brick_files <- hr_files[str_detect(hr_files, "brick")]
print(hr_brick_files)
print(hr_glass_files)

ea_glass_files <- ea_files[str_detect(ea_files, "glass")]
ea_brick_files <- ea_files[str_detect(ea_files, "brick")]

#Function to batch read HR csv files
  read_avg <- function(file) {
  # Extract participant and exposure from filename
  # Example filename: "8-1-HR.csv" → participant 8, exposure 1
  parts <- str_split(basename(file), "-")[[1]]
  participant <- as.integer(parts[1])
  exposure <- parts[2]  # "baseline", "1", "2"
  
  data <- read_csv(file, show_col_types = FALSE)
  avg_value <- mean(data$HR, na.rm = TRUE)
  
  tibble(Participant = participant,
         Exposure = exposure,
         avg_HR = avg_value)
}

#Load HR data
hr_glass <- map_dfr(hr_glass_files, read_avg)
hr_brick <- map_dfr(hr_brick_files, read_avg)

hr_brick_wide <- hr_brick %>%
  pivot_wider(id_cols = Participant,
              names_from = Exposure,
              values_from = avg_HR,
              names_prefix = "HR_") %>%
  mutate(HR_diff_1 = HR_1 - HR_baseline,
         HR_diff_2 = HR_2 - HR_baseline)

hr_glass_wide <- hr_glass %>%
  pivot_wider(id_cols = Participant,
              names_from = Exposure,
              values_from = avg_HR,
              names_prefix = "HR_") %>%
  mutate(HR_diff_1 = HR_1 - HR_baseline,
         HR_diff_2 = HR_2 - HR_baseline)

hr_brick_wide
hr_glass_wide

#Function to batch read EA csv files
  read_avg_1 <- function(file) {
  # Extract participant and exposure from filename
  # Example filename: "8-1-EA.csv" → participant 8, exposure 1
  parts <- str_split(basename(file), "-")[[1]]
  participant <- as.integer(parts[1])
  exposure <- parts[2]  # "baseline", "1", "2"
  
  data <- read_csv(file, show_col_types = FALSE)
  avg_value <- mean(data$EA, na.rm = TRUE)
  
  tibble(Participant = participant,
         Exposure = exposure,
         avg_EA = avg_value)
}

#Load EA data
ea_glass <- map_dfr(ea_glass_files, read_avg_1)
ea_brick <- map_dfr(ea_brick_files, read_avg_1)

ea_glass_wide <- ea_glass %>%
  pivot_wider(id_cols = Participant,
              names_from = Exposure,
              values_from = avg_EA,
              names_prefix = "EA_") %>%
  mutate(EA_diff_1 = EA_1 - EA_baseline,
         EA_diff_2 = EA_2 - EA_baseline)

ea_brick_wide <- ea_brick %>%
  pivot_wider(id_cols = Participant,
              names_from = Exposure,
              values_from = avg_EA,
              names_prefix = "EA_") %>%
  mutate(EA_diff_1 = EA_1 - EA_baseline,
         EA_diff_2 = EA_2 - EA_baseline)

ea_glass_wide
ea_brick_wide
```
```{r}
library(dplyr)
library(tidyr)

#Combine HR data into one long table with dome type
hr_brick <- hr_brick %>% mutate(Dome = "brick")
hr_glass <- hr_glass %>% mutate(Dome = "glass")

hr_all <- bind_rows(hr_brick, hr_glass) %>%
  select(Participant, Exposure, avg_HR, Dome) %>%
  pivot_wider(names_from = Exposure, values_from = avg_HR, names_prefix = "HR_") 

#Combine EA data similarly
ea_brick <- ea_brick %>% mutate(Dome = "brick")
ea_glass <- ea_glass %>% mutate(Dome = "glass")

ea_all <- bind_rows(ea_brick, ea_glass) %>%
  select(Participant, Exposure, avg_EA, Dome) %>%
  pivot_wider(names_from = Exposure, values_from = avg_EA, names_prefix = "EA_")

#Join HR and EA with main dataset
d<- d %>%
  left_join(hr_all, by = c("Participant.." = "Participant")) %>%
  left_join(ea_all, by = c("Participant.." = "Participant", "Dome" = "Dome"))

#Add back the differences
d <- d %>%
  mutate(HR_diff_1 = HR_1 - HR_baseline,
         HR_diff_2 = HR_2 - HR_baseline,
         EA_diff_1 = EA_1 - EA_baseline,
         EA_diff_2 = EA_2 - EA_baseline)

```

```{r}
#Plot HR data per person or show exposures 1 and 2 on the timeline
#Removing dups
d_wide <- d %>%
  select(Participant.., HR_baseline, HR_1, HR_2, HR_diff_1, HR_diff_2, Condition) %>%
  distinct()

t.test(d_wide$HR_baseline, d_wide$HR_1, paired = TRUE) #HR increased a lot from baseline, expected this

#Did the materials have different physiological impacts?
t.test(HR_diff_1 ~ Condition, data = d_wide) #diff 1 is HR_1 - HR_baseline
t.test(HR_diff_2 ~ Condition, data = d_wide) #diff 2 is HR_2 - HR_baseline

t.test(d_wide$HR_1, d_wide$HR_2, paired = TRUE) #This shows us HR goes down from exposure 1 to 2, which is to be expected? Doesn't account for condition, just within subjects.

#t-test for change in heart rate from 1 to 2 based on condition
d_wide <- d_wide %>%
  mutate(HR_change_1to2 = HR_2 - HR_1)
t.test(HR_change_1to2 ~ Condition, data = d_wide)
```
#Participants in condition 1 (glass dome + brick cube) showed an increase in HR from baseline to exposure 2 compared to participants in condition 2 (brick dome + glass cube). This was only significant before collapsing the data rows to remove duplicates.

```{r}
t.test(EA_diff_1 ~ Condition, data = d)
t.test(EA_diff_2 ~ Condition, data = d)
```
